name: –î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

on:
  # 1. –¢—Ä–∏–≥–≥–µ—Ä –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 18:00 UTC
  schedule:
    - cron: '0 18 * * *'
  
  # 2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
  workflow_dispatch:
    inputs:
      manual:
        description: '–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–Ω–µ–≤–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è'
        required: false
        default: 'true'

jobs:
  track-mood:
    runs-on: ubuntu-latest
    
    steps:
      # –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è —Å –ø—Ä–∞–≤–∞–º–∏ –Ω–∞ –∑–∞–ø–∏—Å—å
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      # –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ mood_diary.txt
      - name: Update mood diary
        run: |
          # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ì–ì–ì–ì-–ú–ú-–î–î
          TODAY=$(date -u +'%Y-%m-%d')
          
          echo "üìÖ –°–µ–≥–æ–¥–Ω—è: $TODAY"
          
          # –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, —Å–æ–∑–¥–∞–µ–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
          if [ ! -f mood_diary.txt ]; then
            echo "üìÑ –°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π —Ñ–∞–π–ª mood_diary.txt"
            echo "–î–ù–ï–í–ù–ò–ö –ù–ê–°–¢–†–û–ï–ù–ò–Ø" > mood_diary.txt
            echo "" >> mood_diary.txt
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
          if grep -q "^$TODAY:" mood_diary.txt; then
            echo "‚ÑπÔ∏è –ó–∞–ø–∏—Å—å –∑–∞ $TODAY —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–±–∞–≤–ª—è—é –¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è —Ç–µ—Å—Ç–∞"
            # –î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å
            echo "$TODAY: -----------------------" >> mood_diary.txt
          else
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
            echo "$TODAY: -----------------------" >> mood_diary.txt
            echo "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –∑–∞ $TODAY"
          fi
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
          echo ""
          echo "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ mood_diary.txt:"
          echo "------------------------------"
          cat mood_diary.txt
          echo "------------------------------"
          
      # –®–∞–≥ 3: –ö–æ–º–º–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Commit and push changes
        run: |
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Git
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –∏–Ω–¥–µ–∫—Å
          git add mood_diary.txt
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
          if git diff --cached --quiet; then
            echo "üìù –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            # –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
            COMMIT_MESSAGE="Mood diary update: $(date -u +'%Y-%m-%d %H:%M')"
            git commit -m "$COMMIT_MESSAGE"
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
            git push
            echo "üöÄ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π"
            echo "üí¨ –ö–æ–º–º–∏—Ç: '$COMMIT_MESSAGE'"
          fi
          
          # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
          echo ""
          echo "üîç –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å Git:"
          git status --short
