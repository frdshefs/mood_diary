name: Дневник настроения

on:
  # Триггер по расписанию (каждый день в 18:00 UTC)
  schedule:
    - cron: '0 18 * * *'
  # Триггер для ручного запуска из интерфейса GitHub
  workflow_dispatch:

jobs:
  track-mood:
    runs-on: ubuntu-latest

    steps:
      # Шаг 1: Загружаем код репозитория
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # Это важно, чтобы push сработал
          token: ${{ secrets.GITHUB_TOKEN }}

      # Шаг 2: Создаем или обновляем файл дневника
      - name: Update mood diary
        run: |
          # Определяем сегодняшнюю дату в формате ГГГГ-ММ-ДД
          TODAY=$(date -u +'%Y-%m-%d')
          # Создаем файл, если его нет, и добавляем строку с датой
          echo "$TODAY:" >> mood_diary.txt
          # Выводим содержимое файла в лог для проверки
          echo "Содержимое файла:"
          cat mood_diary.txt

      # Шаг 3: Сохраняем (коммитим) изменения в репозиторий
      - name: Commit and push changes
        run: |
          # Настраиваем git (без этого коммит не получится)
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"

          # Проверяем, есть ли изменения для коммита
          if git diff --quiet; then
            echo "Нет изменений для коммита."
          else
            # Добавляем, коммитим и пушим изменения
            git add mood_diary.txt
            git commit -m "Mood diary update: $(date -u +'%Y-%m-%d')"
            git push
            echo "Изменения успешно запушены."
          fi