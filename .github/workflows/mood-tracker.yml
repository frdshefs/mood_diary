name: –î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

on:
  schedule:
    - cron: '0 18 * * *'
  workflow_dispatch:

jobs:
  track-mood:
    runs-on: ubuntu-latest

    steps:
      # –®–∞–≥ 1: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # –®–∞–≥ 2: –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –ü–†–ê–í–ò–õ–¨–ù–û–ú —Ñ–æ—Ä–º–∞—Ç–µ
      - name: Update mood diary
        run: |
          # –ü–æ–ª—É—á–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
          TODAY=$(date -u +'%Y-%m-%d')
          
          # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
          if [ ! -f mood_diary.txt ]; then
            echo "–î–ù–ï–í–ù–ò–ö –ù–ê–°–¢–†–û–ï–ù–ò–Ø" > mood_diary.txt
            echo "" >> mood_diary.txt
          fi
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
          if ! grep -q "^$TODAY:" mood_diary.txt; then
            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–æ–π –∏ –º–µ—Å—Ç–æ–º –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
            # –§–æ—Ä–º–∞—Ç: 2024-01-15: -----------------------
            echo "$TODAY: -----------------------" >> mood_diary.txt
            echo "‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –∑–∞ $TODAY"
          else
            echo "‚ö†Ô∏è –ó–∞–ø–∏—Å—å –∑–∞ $TODAY —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          fi
          
          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
          echo "üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ mood_diary.txt:"
          cat mood_diary.txt

      # –®–∞–≥ 3: –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      - name: Commit and push
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º git
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
          git add mood_diary.txt
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –∫–æ–º–º–∏—Ç–∞
          if git diff --cached --quiet; then
            echo "üìù –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
          else
            # –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
            git commit -m "–î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–ø–∏—Å—å –∑–∞ $(date -u +'%Y-%m-%d')"
            git push
            echo "üöÄ –ò–∑–º–µ–Ω–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—à–µ–Ω—ã"
          fi
          
          # –î–ª—è –æ—Ç–ª–∞–¥–∫–∏: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å git
          echo "--- –°—Ç–∞—Ç—É—Å git ---"
          git status